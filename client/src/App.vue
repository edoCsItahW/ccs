<!--
  - Copyright (c) 2024. All rights reserved.
  - This source code is licensed under the CC BY-NC-SA
  - (Creative Commons Attribution-NonCommercial-NoDerivatives) License, By Xiao Songtao.
  - This software is protected by copyright law. Reproduction, distribution, or use for commercial
  - purposes is prohibited without the author's permission. If you have any questions or require
  - permission, please contact the author: 2207150234@st.sziit.edu.cn
  -->
<script lang="ts">
/**
 * @file App.vue
 * @author edocsitahw
 * @version 1.1
 * @date 2024/10/22 10:56:04
 * @desc
 * @copyright CC BY-NC-SA 2024. All rights reserved.
 * # è¦æ±‚
 * 1. ç½‘ç«™åŠŸèƒ½
 *     - ï¸â­ï¸ç”¨æˆ·è¾“å…¥: è‡³å°‘å®ç°ä¸€ä¸ªåŠŸèƒ½,å…è®¸ç”¨æˆ·è¾“å…¥å¹¶æäº¤æ•°æ®(å¦‚ç•™è¨€ã€æ³¨å†Œã€ç™»å½•ã€è¯„è®ºç­‰).
 *     - â­ï¸æ•°æ®å­˜å‚¨: å°†ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“,ç¡®ä¿æŒä¹…åŒ–å­˜å‚¨.
 *     - â­ï¸åˆ—è¡¨å±•ç¤º: æä¾›åˆ—è¡¨å±•ç¤ºåŠŸèƒ½(å¦‚å±•ç¤ºç”¨æˆ·åˆ—è¡¨ã€å•†å“ç›®å½•æˆ–è¯„è®ºåˆ—è¡¨).
 *     - â­ï¸è¯¦æƒ…æŸ¥çœ‹: æ”¯æŒç‚¹å‡»åˆ—è¡¨é¡¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯é¡µé¢.
 *     - â­ï¸é¡µé¢å±•ç¤º: ç½‘ç«™é¡µé¢éœ€è®¾è®¡åˆç†,ç¡®ä¿ç”¨æˆ·ä½“éªŒè‰¯å¥½.
 * 2. æŠ€æœ¯æ ˆè¦æ±‚
 *     - å‰ç«¯æŠ€æœ¯: HTMLã€CSSã€JavaScript æˆ–å‰ç«¯æ¡†æ¶(å¦‚ Reactã€â­ï¸Vueã€Bootstrap).
 *     - â­ï¸åç«¯æŠ€æœ¯: ä¸é™(Node.jsã€Djangoã€Spring Boot ç­‰å‡å¯).
 *     - â­ï¸æ•°æ®åº“: ä¸é™(MySQLã€MongoDBç­‰å‡å¯).
 *     - å­¦ç”Ÿéœ€åœ¨é¡¹ç›®æŠ¥å‘Šä¸­è¯´æ˜æ‰€é€‰æŠ€æœ¯åŠå…¶ä½¿ç”¨åŸå› .
 * 3. é¡µé¢å†…å®¹
 *     - ç½‘ç«™é¦–é¡µæ ‡é¢˜æ å¿…é¡»åŒ…å«å­¦ç”Ÿå§“åã€å­¦å·å’Œç½‘ç«™æ ‡é¢˜.
 *     - ç½‘ç«™æ•´ä½“è®¾è®¡éœ€æ¸…æ™°ã€ç¾è§‚,ä¿è¯æ˜“äºå¯¼èˆª.
 * 4. å¼€å‘ä¸æäº¤æ–¹å¼
 *     - ç‹¬ç«‹å¼€å‘: æœ¬æ¬¡å¤§ä½œä¸šè¦æ±‚æ¯ä½å­¦ç”Ÿç‹¬ç«‹å®Œæˆ,æœç»åˆä½œæˆ–æŠ„è¢­.
 *     - æ¼”ç¤ºè§†é¢‘: å½•åˆ¶3-5åˆ†é’Ÿæ¼”ç¤ºè§†é¢‘,å±•ç¤ºç½‘ç«™ä¸»è¦åŠŸèƒ½å’Œä½¿ç”¨æµç¨‹,éœ€è¦å‡ºé•œ,è¾¹æ¼”ç¤ºè¾¹è®²è§£.
 * 5. æäº¤å†…å®¹
 *     - æºä»£ç : åŒ…æ‹¬æ‰€æœ‰å‰åç«¯ä»£ç .(æºä»£ç ä¸­å˜é‡å‘½åéœ€å¸¦ä¸Šè‡ªå·±çš„å§“åæ‹¼éŸ³)
 *     - é¡¹ç›®æŠ¥å‘Š(PDFæ ¼å¼): åŒ…æ‹¬é¡¹ç›®ç®€ä»‹ã€ç³»ç»Ÿæ¶æ„ã€æŠ€æœ¯æ ˆé€‰æ‹©ã€åŠŸèƒ½å®ç°è¯´æ˜ã€å¼€å‘ä¸­é‡åˆ°çš„éš¾ç‚¹åŠè§£å†³æ–¹æ¡ˆ.
 *     - æ¼”ç¤ºè§†é¢‘: ä¸Šä¼ æ¼”ç¤ºè§†é¢‘(æ¼”ç¤ºç¨‹åºå¯åŠ¨ã€åŠŸèƒ½æ¼”ç¤º).
 * */
import { request, API_URL } from "confunc";
import { Store_ } from "@/stores/stores";
import { defineComponent } from "vue";
import { mapState } from "pinia";

import router from "@/router/router";

onload = () => { router.push("/"); };

/**
 * TODO:
 * 1. ç•™è¨€åŠŸèƒ½
 * 2. è¯„åˆ†åŠŸèƒ½
 *    - è¯„åˆ†ç»Ÿè®¡ ğŸ”›
 * 3. å®‰å…¨é—®é¢˜
 *    - SQLæ³¨å…¥  âœ”ï¸
 *    - XSSæ”»å‡»
 *    - CSRFæ”»å‡»
 * 4. ä¼˜åŒ–
 *    - ä¼˜åŒ–åŠ è½½æ–¹å¼(ä¸€æ¬¡æ€§åŠ è½½æ”¹æˆæŒ‰éœ€åŠ è½½)  âŒ
 *    - ä¼˜åŒ–å›¾ç‰‡åŠ è½½æ–¹å¼(æ‡’åŠ è½½)
 * 5. ...
 * */

export default defineComponent({
    name: "App",
    data() {
        return {
            /** @var {Object} screen è§†å£å¤§å°
             * @property {String} w å®½åº¦
             * @property {String} h é«˜åº¦
             * @desc å°†è§†å£å¤§å°ç»‘å®šåˆ°dataä¸­,ä½¿å…¶æˆä¸ºå“åº”å¼æ•°æ®
             * */
            screen: { w: `${window.innerWidth}px`, h: `${window.innerHeight}px` },
            // å“åº”å¼åª’ä»‹
            back: ""
        };
    },
    setup() {
        const store = Store_();

        // ----------------- å‘é€tokenéªŒè¯è¯·æ±‚è·å–ç”¨æˆ·ä¿¡æ¯ -----------------
        const token = localStorage.getItem("token");
        if (token) request(API_URL, "user", { token, type: "check" }).then(
            res => {
                    if (res.code === 200) store.updateUser(res.data);
                    else console.warn(`${res.code} - Check user failed: ${res.msg}!`)
                });
        return { store };
    },
    computed: {
        ...mapState(Store_, {
            // ä¸»é¢˜æ§åˆ¶å®ä¾‹
            color: state => state.color
        })
    },
    methods: {
        /**
         * @desc æ›´æ–°dataä¸­çš„screenå±æ€§
         * @callback
         * */
        updateSize() {
            this.screen.w = `${window.innerWidth}px`;
            this.screen.h = `${window.innerHeight + window.scrollY}px`;
            this.calcuHeader();
        },
        /**
         * @desc è®¡ç®—headerçš„margin-topå€¼,ä½¿å ä½å…ƒç´ å…¶ä¸headerçš„é«˜åº¦ä¸€è‡´
         * */
        calcuHeader() {
            const headerPH = document.getElementById("header-placeholder") as HTMLDivElement;
            if (headerPH) headerPH.style.marginTop = `${document.getElementById("header")?.offsetHeight}px`;
        }
    },
    mounted() {
        this.updateSize();
        window.addEventListener("resize", this.updateSize);
        window.addEventListener("scroll", this.updateSize);
    },
    beforeUnmount() {
        window.removeEventListener("resize", this.updateSize);
        window.removeEventListener("scroll", this.updateSize);
    },
    watch: {
        /**
         * @desc ç”±äºcoloræœ¬èº«éå“åº”,éœ€è¦ä¸»åŠ¨ç›‘å¬å¹¶æ›´æ–°backå±æ€§
         * */
        color: {
            handler(val) {
                this.back = val?.back;
            },
            deep: true,
            immediate: true
        }
    }
});
</script>

<template>

    <div class="root" :style="{ width: screen.w, height: screen.h, backgroundColor: back, color: color.font }">

        <router-view></router-view>

    </div>

</template>

<style lang="sass">
@font-face
    font-family: "EnFont"
    src: url("@/assets/JetBrainsMono-Bold.ttf")
    unicode-range: U+0000-0041, U+0042-007A  // ä»…è‹±æ–‡é€‚ç”¨

body
    margin: 0
    font-family: "EnFont", sans-serif
    overflow-x: hidden

a
    text-decoration: none
    color: inherit

ul
    list-style: none
    margin: 0

h1, h2, h3, h4, h5, h6
    margin: 0
    padding: 0

p
    margin: 0

.root
    display: flex
    flex-direction: column
</style>
